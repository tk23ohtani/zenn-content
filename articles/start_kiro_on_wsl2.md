---
title: VMWare上のWindows11でWSL2をターゲットとするKiro IDE及びKiro-CLIを使う
emoji: 👻
type: tech
topics:
  - AI
  - Agent
published: false
---

# VMWare上のWindows11でWSL2をターゲットとするKiro IDE及びKiro-CLIを使う

WSL2上で使うには最初にちょっとした準備をして進める方がいいのでその手順について残しておく。

というのもの、Windows上にファイルがあっても開発することは可能だが、PowerShell経由だとコマンド起動が遅いのと、`/mnt/...`のようにWindows側のファイルシステムを使うことでもパフォーマンスが落ちるので、直接WSL2上でコマンド起動することと、ファイル操作もLinuxファイルシステムを直接使えるようにする手順となる。

これらを準備していないことで起こる最大の問題は、コマンド実行時、特に比較的時間のかかるテスト実行で実行の完了をKiroがうまく検出できず待てないことがある。AgenticAIの利便性を享受するためにもこの準備は整えた上で進めたい。

```
┌─────────────────────────────────────────────────────────────────┐
│ Host PC (Mac)                                                   │
│ CPU: 8 cores                                                    │
│ ┌─┬─┬─┬─┬─┬─┬─┬─┐                                            │
│ │●│●│●│●│○│○│○│○│  ● = 使用中  ○ = VM に割り当て           │
│ └─┴─┴─┴─┴─┴─┴─┴─┘                                            │
│                ↓ 4 cores 割り当て                              │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ Windows11 Virtual Machine (VM Ware)                      │  │
│  │ CPU: 4 cores (割り当て済み)                               │  │
│  │ ┌─┬─┬─┬─┐                                               │  │
│  │ │●│●│△│△│  ● = Win11使用中  △ = WSL2 に割り当て       │  │
│  │ └─┴─┴─┴─┘                                               │  │
│  │        ↓ 2 cores 割り当て                                │  │
│  │  ┌──────────────┐      ┌─────────────────────────┐       │  │
│  │  │              │      │ WSL2 on Windows11       │       │  │
│  │  │  Kiro IDE    │      │ CPU: 2 cores (割り当て済み)│    │  │
│  │  │              │      │ ┌─┬─┐                   │       │  │
│  │  │              │      │ │■│■│  ■ = WSL2使用中   │       │  │
│  │  │              │      │ └─┴─┘                   │       │  │
│  │  │              │      │  ┌──────────────────┐   │       │  │
│  │  └──────────────┘      │  │   Kiro-CLI       │   │       │  │
│  │                        │  └──────────────────┘   │       │  │
│  │                        └─────────────────────────┘       │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

仮想マシンの中に仮想マシンを動かすことになるので、使えるCPU資源がどんどん少なくなるデメリットがある。

例）ホストPCがもともと8コアであれば、仮想マシンのWin11に4コアを割り当て、4コアのWin11が更にWSL2に2コアを割り当てる、とか。





_Created by T.Ohtani at 2025/08/30_

## ダウンロードとインストール

ともかくKiroをダウンロードする。

![alt text](/images/start_kiro-4.png)

起動するとアカウント登録を要求される。今回はGoogleアカウントで登録した。

WSL2上で使っていくのだが、Power Shell経由でのコマンド起動は起動プロセスのオーバーヘッドが馬鹿にならないので、可能な限り直接WSL2つまりLinuxファイルシステムを直接使った状態にすることで、パフォーマンス向上を図る。

- デフォルトターミナルのWSL2化

KiroのAgentはターミナルを一つ独立して起動して使うことになるので、AgentがWSL2上で直接実行できるようにしておく必要がある。
その設定は`Terminal > Integrated > Default Profile: Windows`で設定する。複数のディストリビューションをインストールしている場合も対応できる。

![alt text](/images/start_kiro-5.png)

- リモート起動

Microsoft謹製のWSL拡張は使えないようなので、次の`Open Remote - WSL`を使わせてもらう。

![alt text](/images/start_kiro-6.png)

Windows側のユーザーフォルダの下にある`%USERPROFILE%.kiro\argv.json`ファイルに次の項目を追加する。

```json
{
    ...
    "enable-proposed-api": [
        ...,
        "jeanp413.open-remote-wsl",
    ]
    ...
}
```

Kiroを再起動して左下のリモート接続アイコンからWSL2に接続して起動する。場合によってはアカウントの再認証になることがある。

![alt text](/images/start_kiro-7.png)

# WSL2のLinuxディストリビューションをC:ドライブ以外に移動

標準ディストリビューションで開発を進めていくとC:ドライブの容量がどんどん圧迫されてくるので、C:ドライブから追い出したい。そこで、D:ドライブにディストリビューションを移動する方法を記す。

- お悩みポイント
    - WindowsでWeb系アプリケーションをWSL2上で作りたい
    - WSL2のディストリビューションを分けて使いたい
    - C:ドライブは空けておきたい

# WSL2のディストリビューションをC:ドライブ以外に作る

WSL2は標準インストールされているものとする。

## ディストリビューションを準備

標準の`Ubuntu`ディストリビューションを複製して、D:ドライブに`DevUbuntu`として新たにLinuxディストリビューションを作る。インストールされている状態を確認する。

```powershell
wsl --list --verbose
```

問題なくインストールされていれば、標準の`Ubuntu`ディストリビューションが見えるはずなので、これをエクスポートする。

```
  NAME         STATE           VERSION
* Ubuntu       Stopped         2
```

標準の`Ubuntu`ディストリビューションをエクスポートしてD:ドライブ上に圧縮ファイルを作る。

```powershell
wsl --export Ubuntu D:\DevUbuntu.tar
```

## ディストリビューションを作成

作成した圧縮ファイルをD:ドライブ上にインポートして新たに`DevUbuntu`として新たにLinuxディストリビューションを作る。インポート先のディレクトリは予め作っておくと良い。圧縮ファイルが不要な場合は、`rm`コマンドで削除しておくと良い。

```powershell
mkdir D:\WSL2
wsl --import DevUbuntu D:\WSL2 D:\DevUbuntu.tar
rm D:\DevUbuntu.tar
```

## デフォルトのディストリビューションを指定（任意）

標準ディストリビューションは可能な限り温存しておくので、デフォルトのディストリビューションを今回作成したディストリビューションに変更しておく。

```powershell
wsl --set-default DevUbuntu
wsl --list --verbose
```

デフォルトのディストリビューションには`*`が付く。

```
  NAME         STATE           VERSION
* DevUbuntu    Stopped         2
  Ubuntu       Stopped         2
```


